\documentclass[11pt,a4paper]{article}

\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{geometry}

\usepackage{../tdstyle}

\geometry{margin=2.5cm}

\title{TD3 -- Langages de script}
\author{Abdallah Ammar}
\date{\today}

\begin{document}
\maketitle



\begin{warningbox}
Il est fortement recommandé de taper les commandes à la main afin de se familiariser
avec le terminal.
\end{warningbox}

% --------------------------------------------------
\section*{Récupération des fichiers de données}

Dans ce TD, vous allez travailler sur des fichiers texte fournis par l'enseignant.
Ces fichiers contiennent des données fictives destinées à l'apprentissage
des commandes de filtrage et d'analyse de texte.

Commencez par créer un répertoire \texttt{data}, puis téléchargez les fichiers
à l'aide des commandes suivantes :

\begin{terminal}
\prompt\ \shcmd{mkdir} data

\prompt\ \shcmd{cd} data

\prompt\ \shcmd{wget} https://raw.githubusercontent.com/AbdAmmar/LDS/main/TD/TD3/data/users.txt

\prompt\ \shcmd{wget} https://raw.githubusercontent.com/AbdAmmar/LDS/main/TD/TD3/data/logs.txt

\prompt\ \shcmd{wget} https://raw.githubusercontent.com/AbdAmmar/LDS/main/TD/TD3/data/notes.txt
\end{terminal}

Vérifiez que les fichiers ont bien été téléchargés.
Si la commande \texttt{wget} n'est pas disponible, installez-la avec :

\begin{terminal}
\prompt\ \shcmd{sudo} apt update

\prompt\ \shcmd{sudo} apt install wget
\end{terminal}

\bigskip

% --------------------------------------------------
\section{Lire et compter}

\subsection*{Travail à faire}

\begin{enumerate}
    \item Affichez le contenu du fichier \texttt{users.txt}.
    \item Comptez le nombre de lignes du fichier.
    \item Affichez le contenu du fichier \texttt{logs.txt}.
    \item Comptez le nombre de lignes du fichier \texttt{notes.txt}.
\end{enumerate}

\subsection*{Commandes utiles}

\begin{terminal}
\prompt\ \shcmd{cat} users.txt

\prompt\ \shcmd{wc} \texttt{-l} users.txt
\end{terminal}

% --------------------------------------------------
\section{Introduction aux pipes}

Un \textit{pipe} permet d'envoyer la sortie d'une commande en entrée d'une autre.

\subsection*{Travail à faire}

\begin{enumerate}
    \item Comptez le nombre de lignes de \texttt{users.txt} sans afficher le contenu du fichier.
    \item Expliquez le rôle du symbole \texttt{|}.
\end{enumerate}

\subsection*{Commande clé}

\begin{terminal}
\prompt\ \shcmd{cat} users.txt \texttt{|} \shcmd{wc} \texttt{-l}
\end{terminal}

% --------------------------------------------------
\section{Rechercher des informations avec \texttt{grep}}

\subsection*{Travail à faire}

À partir du fichier \texttt{users.txt} :

\begin{enumerate}
    \item Affichez les lignes contenant \texttt{bash}.
    \item Comptez le nombre d'utilisateurs utilisant \texttt{bash}.
    \item Affichez les lignes ne contenant pas \texttt{bash}.
\end{enumerate}

\subsection*{Commandes utiles}

\begin{terminal}
\prompt\ \shcmd{grep} bash users.txt

\prompt\ \shcmd{grep} \texttt{-c} bash users.txt

\prompt\ \shcmd{grep} \texttt{-v} bash users.txt
\end{terminal}

% --------------------------------------------------
\section{Extraire des informations}

Le fichier \texttt{users.txt} est structuré : les champs sont séparés par le caractère \texttt{:}.

\subsection*{Travail à faire}

\begin{enumerate}
    \item Affichez uniquement la colonne des noms d'utilisateurs.
    \item Affichez uniquement la colonne des shells.
\end{enumerate}

\subsection*{Commandes utiles}

\begin{terminal}
\prompt\ \shcmd{cut} \texttt{-d: -f1} users.txt

\prompt\ \shcmd{cut} \texttt{-d: -f2} users.txt
\end{terminal}

% --------------------------------------------------
\section{Trier et compter}

\subsection*{Travail à faire}

\begin{enumerate}
    \item Affichez la liste des shells utilisés.
    \item Triez cette liste.
    \item Comptez combien de fois chaque shell apparaît.
\end{enumerate}

\subsection*{Pipeline attendu}

\begin{terminal}
\prompt\ \shcmd{cut} \texttt{-d: -f2} users.txt \texttt{|} \shcmd{sort} \texttt{|} \shcmd{uniq} \texttt{-c}
\end{terminal}

% --------------------------------------------------
\section{Analyse de fichiers de logs}

\subsection*{Travail à faire}

À partir du fichier \texttt{logs.txt} :

\begin{enumerate}
    \item Affichez uniquement les lignes contenant \texttt{ERROR}.
    \item Comptez le nombre d'erreurs.
    \item Affichez les noms des utilisateurs ayant généré une erreur.
\end{enumerate}

\subsection*{Commandes utiles}

\begin{terminal}
\prompt\ \shcmd{grep} ERROR logs.txt

\prompt\ \shcmd{grep} \texttt{-c} ERROR logs.txt

\prompt\ \shcmd{grep} ERROR logs.txt \texttt{|} \shcmd{cut} \texttt{-d= -f2}
\end{terminal}

% --------------------------------------------------
\section{Mini-analyse}

\subsection*{Travail à faire}

Sans utiliser d'éditeur de texte :

\begin{itemize}
    \item Quel est le shell le plus utilisé ?
    \item Quel utilisateur apparaît le plus souvent dans les logs ?
\end{itemize}

Justifiez vos réponses à l'aide de commandes Linux.


\section*{Pour aller plus loin -- Exercice ludique (optionnel)}

Installez les programmes \texttt{cowsay} et \texttt{fortune}.
Testez ensuite l'utilisation d'un pipe entre les deux commandes.

\begin{terminal}
\prompt\ \shcmd{sudo} apt install cowsay fortune

\prompt\ \shcmd{fortune}

\prompt\ \shcmd{fortune} \texttt{|} \shcmd{cowsay}
\end{terminal}

\end{document}
